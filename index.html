<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intune Policy Conflict Analyzer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #0d1117;
            --bg-tertiary: #151b23;
            --bg-elevated: #1c232d;
            --border-primary: #2d3748;
            --border-secondary: #3d4a5c;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-blue: #0078d4;
            --accent-blue-hover: #1a86d9;
            --accent-cyan: #00d4aa;
            --accent-purple: #8b5cf6;
            --accent-orange: #f97316;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
            --accent-green: #22c55e;
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 40px rgba(0, 120, 212, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .slide-in { animation: slideIn 0.3s ease-out forwards; }

        .app-container { min-height: 100vh; display: flex; flex-direction: column; }

        .header {
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-bottom: 1px solid var(--border-primary);
            padding: 1.25rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section { display: flex; align-items: center; gap: 1rem; }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-cyan) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
            box-shadow: var(--shadow-glow);
        }

        .logo-text h1 { font-size: 1.25rem; font-weight: 600; letter-spacing: -0.02em; }
        .logo-text span { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.1em; }

        .header-actions { display: flex; align-items: center; gap: 1rem; }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            font-size: 0.875rem;
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            background: var(--accent-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .main-content { flex: 1; max-width: 1600px; margin: 0 auto; padding: 2rem; width: 100%; }

        .auth-container { display: flex; align-items: center; justify-content: center; min-height: calc(100vh - 200px); }

        .auth-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 3rem;
            max-width: 480px;
            width: 100%;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .auth-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-cyan) 100%);
            border-radius: 20px;
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .auth-card h2 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
        .auth-card p { color: var(--text-secondary); margin-bottom: 2rem; }

        .auth-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: var(--accent-red);
            font-size: 0.875rem;
        }

        .permissions-list {
            text-align: left;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .permissions-list h4 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8125rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .permission-item svg { color: var(--accent-green); flex-shrink: 0; }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
        }

        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover { background: var(--accent-blue-hover); transform: translateY(-1px); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-primary); }
        .btn-secondary:hover { background: var(--bg-elevated); border-color: var(--border-secondary); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-icon { padding: 0.5rem; }
        .btn-large { padding: 1rem 2rem; font-size: 1rem; }

        .dashboard-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        .dashboard-title h2 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.25rem; }
        .dashboard-title p { color: var(--text-secondary); font-size: 0.9375rem; }
        .dashboard-actions { display: flex; gap: 0.75rem; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s ease;
        }

        .stat-card:hover { border-color: var(--border-secondary); transform: translateY(-2px); }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 0.5rem; }
        .stat-value { font-size: 2rem; font-weight: 600; line-height: 1; }
        .stat-value.conflicts { color: var(--accent-red); }
        .stat-value.policies { color: var(--accent-blue); }
        .stat-value.clean { color: var(--accent-green); }

        .tabs-container { margin-bottom: 1.5rem; }

        .tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-secondary);
            padding: 0.25rem;
            border-radius: 10px;
            border: 1px solid var(--border-primary);
            overflow-x: auto;
        }

        .tab {
            padding: 0.625rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            background: transparent;
            border: none;
            font-family: inherit;
        }

        .tab:hover { color: var(--text-primary); background: var(--bg-tertiary); }
        .tab.active { background: var(--accent-blue); color: white; }

        .tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        .tab:not(.active) .tab-badge { background: var(--bg-elevated); }
        .tab-badge.conflicts { background: var(--accent-red); color: white; }

        .conflicts-list { display: flex; flex-direction: column; gap: 1rem; }

        .conflict-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .conflict-card:hover { border-color: var(--border-secondary); }
        .conflict-card.severity-high { border-left: 4px solid var(--accent-red); }
        .conflict-card.severity-medium { border-left: 4px solid var(--accent-orange); }
        .conflict-card.severity-low { border-left: 4px solid var(--accent-yellow); }

        .conflict-header {
            padding: 1rem 1.25rem;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1rem;
            cursor: pointer;
        }

        .conflict-header:hover { background: var(--bg-tertiary); }
        .conflict-info { flex: 1; min-width: 0; }
        .conflict-title { font-weight: 600; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.75rem; }

        .conflict-setting {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--accent-cyan);
            background: var(--bg-primary);
            padding: 0.125rem 0.5rem;
            border-radius: 4px;
        }

        .conflict-meta { display: flex; flex-wrap: wrap; gap: 1rem; font-size: 0.8125rem; color: var(--text-secondary); }
        .conflict-meta-item { display: flex; align-items: center; gap: 0.375rem; }

        .severity-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .severity-badge.high { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .severity-badge.medium { background: rgba(249, 115, 22, 0.15); color: var(--accent-orange); }
        .severity-badge.low { background: rgba(234, 179, 8, 0.15); color: var(--accent-yellow); }

        .conflict-expand-icon { color: var(--text-muted); transition: transform 0.2s ease; }
        .conflict-card.expanded .conflict-expand-icon { transform: rotate(180deg); }

        .conflict-details { padding: 0 1.25rem 1.25rem; border-top: 1px solid var(--border-primary); margin-top: -1px; }
        .conflict-details-inner { padding-top: 1.25rem; }

        .policy-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1.25rem; }

        .policy-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            padding: 1rem;
        }

        .policy-item-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; font-weight: 500; }

        .policy-type-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .policy-type-icon.settings-catalog { background: var(--accent-blue); }
        .policy-type-icon.device-config { background: var(--accent-purple); }
        .policy-type-icon.endpoint-security { background: var(--accent-red); }
        .policy-type-icon.compliance { background: var(--accent-green); }
        .policy-type-icon.app-protection { background: var(--accent-orange); }
        .policy-type-icon.scripts { background: var(--accent-cyan); }
        .policy-type-icon.update-rings { background: var(--accent-yellow); color: #000; }
        .policy-type-icon.admin-templates { background: #6366f1; }

        .policy-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            margin-bottom: 0.75rem;
            word-break: break-all;
        }

        .policy-assignments { font-size: 0.8125rem; color: var(--text-secondary); }

        .assignment-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.125rem 0.5rem;
            background: var(--bg-elevated);
            border-radius: 4px;
            margin: 0.25rem 0.25rem 0 0;
            font-size: 0.75rem;
        }

        .resolution-section {
            background: rgba(34, 197, 94, 0.08);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            padding: 1rem;
        }

        .resolution-title { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: var(--accent-green); margin-bottom: 0.75rem; }
        .resolution-steps { font-size: 0.875rem; color: var(--text-secondary); }
        .resolution-steps ol { margin-left: 1.25rem; }
        .resolution-steps li { margin-bottom: 0.5rem; }

        .policy-table {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            overflow: hidden;
        }

        .policy-table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 120px;
            gap: 1rem;
            padding: 0.875rem 1.25rem;
            background: var(--bg-tertiary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            font-weight: 600;
        }

        .policy-table-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 120px;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border-primary);
            align-items: center;
            font-size: 0.875rem;
            transition: background 0.2s ease;
        }

        .policy-table-row:hover { background: var(--bg-tertiary); }
        .policy-name { font-weight: 500; display: flex; align-items: center; gap: 0.75rem; }

        .policy-status {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.625rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .policy-status.has-conflicts { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .policy-status.clean { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }

        .loading-container { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; text-align: center; }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border-secondary);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1.5rem;
        }

        .loading-progress { width: 100%; max-width: 400px; margin-top: 1.5rem; }
        .progress-bar { height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden; margin-bottom: 0.5rem; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue) 0%, var(--accent-cyan) 100%); border-radius: 2px; transition: width 0.3s ease; }
        .progress-text { font-size: 0.8125rem; color: var(--text-secondary); }

        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; text-align: center; }
        .empty-icon { width: 80px; height: 80px; background: var(--bg-tertiary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin-bottom: 1.5rem; }
        .empty-state h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }
        .empty-state p { color: var(--text-secondary); max-width: 400px; }

        .filter-bar { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 0.625rem 1rem;
            padding-left: 2.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .search-input:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.15); }
        .search-wrapper { position: relative; flex: 1; min-width: 250px; }
        .search-icon { position: absolute; left: 0.875rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

        .filter-select {
            padding: 0.625rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text-primary);
            cursor: pointer;
            min-width: 160px;
        }

        .filter-select:focus { outline: none; border-color: var(--accent-blue); }

        .toast-container { position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; display: flex; flex-direction: column; gap: 0.75rem; }

        .toast {
            background: var(--bg-elevated);
            border: 1px solid var(--border-secondary);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease-out;
            min-width: 300px;
        }

        .toast.success { border-color: var(--accent-green); }
        .toast.error { border-color: var(--accent-red); }
        .toast-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .toast.success .toast-icon { background: var(--accent-green); }
        .toast.error .toast-icon { background: var(--accent-red); }

        @media (max-width: 768px) {
            .header { padding: 1rem; }
            .main-content { padding: 1rem; }
            .auth-card { padding: 2rem 1.5rem; }
            .policy-table-header, .policy-table-row { grid-template-columns: 1fr; gap: 0.5rem; }
            .policy-table-header > *:not(:first-child) { display: none; }
            .policy-comparison { grid-template-columns: 1fr; }
            .dashboard-header { flex-direction: column; align-items: flex-start; }
            .dashboard-actions { width: 100%; }
            .dashboard-actions .btn { flex: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Configuration
        const CONFIG = {
            clientId: '14d82eec-204b-4c2f-b7e8-296a70dab67e',
            scopes: ['DeviceManagementConfiguration.Read.All', 'DeviceManagementManagedDevices.Read.All', 'DeviceManagementApps.Read.All', 'Group.Read.All'],
            graphBaseUrl: 'https://graph.microsoft.com/beta'
        };

        // Initialize MSAL
        const msalConfig = {
            auth: {
                clientId: CONFIG.clientId,
                authority: 'https://login.microsoftonline.com/common',
                redirectUri: window.location.origin + window.location.pathname,
            },
            cache: { cacheLocation: 'localStorage', storeAuthStateInCookie: false }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        // Icons
        const Icons = {
            Shield: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            AlertTriangle: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
            Check: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            ChevronDown: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>,
            RefreshCw: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>,
            Search: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
            LogOut: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
            Lightbulb: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0018 8 6 6 0 006 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 019 14"/></svg>,
            Users: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>,
            Layers: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
            Download: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Microsoft: () => <svg width="18" height="18" viewBox="0 0 21 21"><rect x="1" y="1" width="9" height="9" fill="#f25022"/><rect x="11" y="1" width="9" height="9" fill="#7fba00"/><rect x="1" y="11" width="9" height="9" fill="#00a4ef"/><rect x="11" y="11" width="9" height="9" fill="#ffb900"/></svg>
        };

        // Auth Hook
        const useAuth = () => {
            const [authState, setAuthState] = useState({ isAuthenticated: false, accessToken: null, user: null, isLoading: true });
            const [authError, setAuthError] = useState(null);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await msalInstance.initialize();
                        const response = await msalInstance.handleRedirectPromise();
                        if (response) {
                            setAuthState({ isAuthenticated: true, accessToken: response.accessToken, user: response.account, isLoading: false });
                            return;
                        }
                        const accounts = msalInstance.getAllAccounts();
                        if (accounts.length > 0) {
                            try {
                                const silentResponse = await msalInstance.acquireTokenSilent({ scopes: CONFIG.scopes, account: accounts[0] });
                                setAuthState({ isAuthenticated: true, accessToken: silentResponse.accessToken, user: silentResponse.account, isLoading: false });
                            } catch (e) {
                                setAuthState(prev => ({ ...prev, isLoading: false }));
                            }
                        } else {
                            setAuthState(prev => ({ ...prev, isLoading: false }));
                        }
                    } catch (e) {
                        console.error('Auth init error:', e);
                        setAuthState(prev => ({ ...prev, isLoading: false }));
                    }
                };
                initAuth();
            }, []);

            const login = async () => {
                setAuthError(null);
                try {
                    const response = await msalInstance.loginPopup({ scopes: CONFIG.scopes, prompt: 'select_account' });
                    setAuthState({ isAuthenticated: true, accessToken: response.accessToken, user: response.account, isLoading: false });
                } catch (error) {
                    console.error('Login error:', error);
                    setAuthError(error.message || 'Authentication failed. Please try again.');
                }
            };

            const logout = async () => {
                try {
                    await msalInstance.logoutPopup();
                } catch (e) {}
                localStorage.clear();
                setAuthState({ isAuthenticated: false, accessToken: null, user: null, isLoading: false });
            };

            const getValidToken = async () => {
                const accounts = msalInstance.getAllAccounts();
                if (accounts.length === 0) throw new Error('No authenticated account');
                try {
                    const response = await msalInstance.acquireTokenSilent({ scopes: CONFIG.scopes, account: accounts[0] });
                    return response.accessToken;
                } catch (e) {
                    const response = await msalInstance.acquireTokenPopup({ scopes: CONFIG.scopes });
                    return response.accessToken;
                }
            };

            return { ...authState, authError, login, logout, getValidToken };
        };

        // Graph API
        const useGraphApi = (getValidToken) => {
            const fetchGraph = async (endpoint) => {
                const token = await getValidToken();
                const url = endpoint.startsWith('http') ? endpoint : `${CONFIG.graphBaseUrl}${endpoint}`;
                const response = await fetch(url, { headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' } });
                if (!response.ok) {
                    const error = await response.json().catch(() => ({}));
                    throw new Error(error.error?.message || `Graph API error: ${response.status}`);
                }
                return response.json();
            };

            const fetchAllPages = async (endpoint) => {
                const results = [];
                let url = endpoint;
                while (url) {
                    const response = await fetchGraph(url);
                    if (response.value) results.push(...response.value);
                    url = response['@odata.nextLink'];
                }
                return results;
            };

            return { fetchGraph, fetchAllPages };
        };

        // Policy Types
        const POLICY_TYPES = {
            settingsCatalog: { name: 'Settings Catalog', endpoint: '/deviceManagement/configurationPolicies', settingsEndpoint: (id) => `/deviceManagement/configurationPolicies/${id}/settings`, assignmentsEndpoint: (id) => `/deviceManagement/configurationPolicies/${id}/assignments`, icon: 'settings-catalog' },
            deviceConfiguration: { name: 'Device Configuration', endpoint: '/deviceManagement/deviceConfigurations', assignmentsEndpoint: (id) => `/deviceManagement/deviceConfigurations/${id}/assignments`, icon: 'device-config' },
            endpointSecurity: { name: 'Endpoint Security', endpoint: '/deviceManagement/intents', settingsEndpoint: (id) => `/deviceManagement/intents/${id}/settings`, assignmentsEndpoint: (id) => `/deviceManagement/intents/${id}/assignments`, icon: 'endpoint-security' },
            compliance: { name: 'Compliance Policies', endpoint: '/deviceManagement/deviceCompliancePolicies', assignmentsEndpoint: (id) => `/deviceManagement/deviceCompliancePolicies/${id}/assignments`, icon: 'compliance' },
            appProtection: { name: 'App Protection', endpoint: '/deviceAppManagement/managedAppPolicies', icon: 'app-protection' },
            scripts: { name: 'PowerShell Scripts', endpoint: '/deviceManagement/deviceManagementScripts', assignmentsEndpoint: (id) => `/deviceManagement/deviceManagementScripts/${id}/assignments`, icon: 'scripts' },
            adminTemplates: { name: 'Administrative Templates', endpoint: '/deviceManagement/groupPolicyConfigurations', valuesEndpoint: (id) => `/deviceManagement/groupPolicyConfigurations/${id}/definitionValues`, assignmentsEndpoint: (id) => `/deviceManagement/groupPolicyConfigurations/${id}/assignments`, icon: 'admin-templates' }
        };

        // Conflict Analysis Functions
        const extractSettingValue = (settingDef) => {
            if (settingDef.choiceSettingValue) return settingDef.choiceSettingValue.value;
            if (settingDef.simpleSettingValue) return settingDef.simpleSettingValue.value;
            return settingDef.value || settingDef;
        };

        const formatSettingValue = (value) => {
            if (value === null || value === undefined) return 'Not configured';
            if (typeof value === 'boolean') return value ? 'Enabled' : 'Disabled';
            if (typeof value === 'object') return JSON.stringify(value);
            return String(value);
        };

        const cleanSettingName = (name) => {
            if (!name) return 'Unknown Setting';
            const parts = name.split('_');
            if (parts.length > 2) return parts.slice(-2).join(' ').replace(/([A-Z])/g, ' $1').trim();
            return name.replace(/([A-Z])/g, ' $1').trim();
        };

        const determineSeverity = (instances) => {
            const policyTypes = new Set(instances.map(i => i.policyType));
            if (policyTypes.size > 1) return 'high';
            const settingName = (instances[0].settingName || '').toLowerCase();
            if (['firewall', 'bitlocker', 'defender', 'password', 'encryption', 'security'].some(k => settingName.includes(k))) return 'high';
            return 'medium';
        };

        const generateResolution = (instances) => {
            const steps = ['Consolidate this setting into a single policy type (preferably Settings Catalog)', 'Review the assignment groups to ensure only necessary devices are targeted', 'Determine the correct value based on your security requirements'];
            const winner = instances.find(i => i.policyType === 'settingsCatalog') || instances[0];
            steps.push(`Consider using the value "${winner.valueDisplay}" from "${winner.policy.displayName || winner.policy.name}"`);
            return steps;
        };

        const analyzeConflicts = (allPolicies, assignments, settings) => {
            const conflicts = [];
            const settingsMap = new Map();

            Object.entries(allPolicies).forEach(([policyType, policies]) => {
                policies.forEach(policy => {
                    const policySettings = settings[policy.id] || [];
                    const policyAssignments = assignments[policy.id] || [];
                    const assignedGroups = policyAssignments.map(a => a.target?.groupId || a.target?.['@odata.type'] || 'All Devices');

                    if (policyType === 'settingsCatalog') {
                        policySettings.forEach(setting => {
                            const settingDef = setting.settingInstance;
                            if (!settingDef) return;
                            const settingId = settingDef['@odata.type'] + ':' + (settingDef.settingDefinitionId || 'unknown');
                            const value = extractSettingValue(settingDef);
                            if (!settingsMap.has(settingId)) settingsMap.set(settingId, []);
                            settingsMap.get(settingId).push({ policy, policyType, settingId, settingName: settingDef.settingDefinitionId || settingId, value, valueDisplay: formatSettingValue(value), assignments: policyAssignments, assignedGroups });
                        });
                    }

                    if (policyType === 'deviceConfiguration') {
                        const skipKeys = ['id', 'displayName', 'description', 'version', 'createdDateTime', 'lastModifiedDateTime', '@odata.type', 'supportsScopeTags', 'roleScopeTagIds'];
                        Object.entries(policy).forEach(([key, value]) => {
                            if (!skipKeys.includes(key) && value !== null && value !== undefined) {
                                const settingId = `deviceConfig:${key}`;
                                if (!settingsMap.has(settingId)) settingsMap.set(settingId, []);
                                settingsMap.get(settingId).push({ policy, policyType, settingId, settingName: key, value, valueDisplay: formatSettingValue(value), assignments: policyAssignments, assignedGroups });
                            }
                        });
                    }
                });
            });

            settingsMap.forEach((instances, settingId) => {
                if (instances.length < 2) return;
                const valueGroups = new Map();
                instances.forEach(instance => {
                    const valueKey = JSON.stringify(instance.value);
                    if (!valueGroups.has(valueKey)) valueGroups.set(valueKey, []);
                    valueGroups.get(valueKey).push(instance);
                });
                if (valueGroups.size > 1) {
                    const allInstances = Array.from(valueGroups.values()).flat();
                    const severity = determineSeverity(allInstances);
                    conflicts.push({ id: settingId, settingName: cleanSettingName(allInstances[0].settingName), instances: allInstances, severity, resolution: generateResolution(allInstances) });
                }
            });

            return conflicts.sort((a, b) => ({ high: 0, medium: 1, low: 2 }[a.severity] - { high: 0, medium: 1, low: 2 }[b.severity]));
        };

        // Components
        const Header = ({ user, onLogout }) => (
            <header className="header">
                <div className="header-content">
                    <div className="logo-section">
                        <div className="logo-icon"><Icons.Shield /></div>
                        <div className="logo-text"><h1>Intune Policy Conflict Analyzer</h1><span>Policy Management Tool</span></div>
                    </div>
                    {user && (
                        <div className="header-actions">
                            <div className="user-badge">
                                <div className="user-avatar">{(user.name || user.username || 'U')[0].toUpperCase()}</div>
                                <span>{user.name || user.username || 'User'}</span>
                            </div>
                            <button className="btn btn-secondary btn-icon" onClick={onLogout} title="Sign out"><Icons.LogOut /></button>
                        </div>
                    )}
                </div>
            </header>
        );

        const AuthScreen = ({ onLogin, error }) => (
            <div className="auth-container">
                <div className="auth-card fade-in">
                    <div className="auth-icon"><Icons.Shield /></div>
                    <h2>Sign in to Analyze Policies</h2>
                    <p>Connect to Microsoft Graph to fetch and analyze your Intune policies for conflicts.</p>
                    {error && <div className="auth-error">{error}</div>}
                    <div className="permissions-list">
                        <h4>Required Permissions</h4>
                        <div className="permission-item"><Icons.Check /><span>Read Intune device configurations</span></div>
                        <div className="permission-item"><Icons.Check /><span>Read Intune compliance policies</span></div>
                        <div className="permission-item"><Icons.Check /><span>Read app protection policies</span></div>
                        <div className="permission-item"><Icons.Check /><span>Read group memberships</span></div>
                    </div>
                    <button className="btn btn-primary btn-large" onClick={onLogin} style={{ width: '100%' }}><Icons.Microsoft />Sign in with Microsoft</button>
                </div>
            </div>
        );

        const LoadingScreen = ({ progress, status }) => (
            <div className="loading-container">
                <div className="loading-spinner"></div>
                <h3>Analyzing Policies</h3>
                <p style={{ color: 'var(--text-secondary)' }}>{status}</p>
                <div className="loading-progress">
                    <div className="progress-bar"><div className="progress-fill" style={{ width: `${progress}%` }}></div></div>
                    <div className="progress-text">{Math.round(progress)}% complete</div>
                </div>
            </div>
        );

        const ConflictCard = ({ conflict, expanded, onToggle }) => (
            <div className={`conflict-card severity-${conflict.severity} ${expanded ? 'expanded' : ''}`}>
                <div className="conflict-header" onClick={onToggle}>
                    <div className="conflict-info">
                        <div className="conflict-title"><span className="conflict-setting">{conflict.settingName}</span></div>
                        <div className="conflict-meta">
                            <span className="conflict-meta-item"><Icons.Layers />{conflict.instances.length} policies</span>
                            <span className="conflict-meta-item"><Icons.Users />{new Set(conflict.instances.flatMap(i => i.assignedGroups)).size} groups</span>
                        </div>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                        <span className={`severity-badge ${conflict.severity}`}>{conflict.severity}</span>
                        <span className="conflict-expand-icon"><Icons.ChevronDown /></span>
                    </div>
                </div>
                {expanded && (
                    <div className="conflict-details">
                        <div className="conflict-details-inner">
                            <div className="policy-comparison">
                                {conflict.instances.map((instance, idx) => (
                                    <div className="policy-item" key={idx}>
                                        <div className="policy-item-header">
                                            <span className={`policy-type-icon ${POLICY_TYPES[instance.policyType]?.icon || ''}`}>{(POLICY_TYPES[instance.policyType]?.name || 'P')[0]}</span>
                                            <span>{instance.policy.displayName || instance.policy.name}</span>
                                        </div>
                                        <div className="policy-value">{instance.valueDisplay}</div>
                                        <div className="policy-assignments">
                                            <strong>Assignments:</strong>
                                            <div>{instance.assignedGroups.slice(0, 3).map((group, gIdx) => <span className="assignment-tag" key={gIdx}>{group.includes('allDevices') ? 'All Devices' : group.includes('allUsers') ? 'All Users' : group.substring(0, 12) + '...'}</span>)}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="resolution-section">
                                <div className="resolution-title"><Icons.Lightbulb />Recommended Resolution</div>
                                <div className="resolution-steps"><ol>{conflict.resolution.map((step, idx) => <li key={idx}>{step}</li>)}</ol></div>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        );

        const Dashboard = ({ policies, conflicts, onRefresh, isRefreshing }) => {
            const [activeTab, setActiveTab] = useState('conflicts');
            const [searchQuery, setSearchQuery] = useState('');
            const [severityFilter, setSeverityFilter] = useState('all');
            const [expandedId, setExpandedId] = useState(null);

            const totalPolicies = Object.values(policies).reduce((sum, arr) => sum + arr.length, 0);
            const stats = { totalPolicies, conflicts: conflicts.length, highSeverity: conflicts.filter(c => c.severity === 'high').length, cleanPolicies: totalPolicies - new Set(conflicts.flatMap(c => c.instances.map(i => i.policy.id))).size };

            const filteredConflicts = conflicts.filter(c => {
                if (severityFilter !== 'all' && c.severity !== severityFilter) return false;
                if (searchQuery) return c.settingName.toLowerCase().includes(searchQuery.toLowerCase());
                return true;
            });

            const exportReport = () => {
                const report = { generatedAt: new Date().toISOString(), summary: stats, conflicts: conflicts.map(c => ({ settingName: c.settingName, severity: c.severity, policies: c.instances.map(i => ({ name: i.policy.displayName, type: i.policyType, value: i.valueDisplay })), resolution: c.resolution })) };
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `intune-conflicts-${new Date().toISOString().split('T')[0]}.json`; a.click();
            };

            const tabs = [
                { id: 'conflicts', label: 'Conflicts', badge: conflicts.length, badgeClass: conflicts.length > 0 ? 'conflicts' : '' },
                ...Object.entries(POLICY_TYPES).map(([id, config]) => ({ id, label: config.name, badge: policies[id]?.length || 0 }))
            ];

            return (
                <div className="fade-in">
                    <div className="dashboard-header">
                        <div className="dashboard-title"><h2>Policy Analysis Results</h2><p>Review detected conflicts and their recommended resolutions</p></div>
                        <div className="dashboard-actions">
                            <button className="btn btn-secondary" onClick={exportReport}><Icons.Download /> Export</button>
                            <button className="btn btn-primary" onClick={onRefresh} disabled={isRefreshing}><Icons.RefreshCw /> {isRefreshing ? 'Refreshing...' : 'Refresh'}</button>
                        </div>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card"><div className="stat-label">Total Policies</div><div className="stat-value policies">{stats.totalPolicies}</div></div>
                        <div className="stat-card"><div className="stat-label">Conflicts Found</div><div className="stat-value conflicts">{stats.conflicts}</div></div>
                        <div className="stat-card"><div className="stat-label">High Severity</div><div className="stat-value conflicts">{stats.highSeverity}</div></div>
                        <div className="stat-card"><div className="stat-label">Clean Policies</div><div className="stat-value clean">{stats.cleanPolicies}</div></div>
                    </div>

                    <div className="tabs-container">
                        <div className="tabs">
                            {tabs.map(tab => <button key={tab.id} className={`tab ${activeTab === tab.id ? 'active' : ''}`} onClick={() => setActiveTab(tab.id)}>{tab.label}<span className={`tab-badge ${tab.badgeClass || ''}`}>{tab.badge}</span></button>)}
                        </div>
                    </div>

                    {activeTab === 'conflicts' && (
                        <>
                            <div className="filter-bar">
                                <div className="search-wrapper">
                                    <span className="search-icon"><Icons.Search /></span>
                                    <input type="text" className="search-input" placeholder="Search conflicts..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                                </div>
                                <select className="filter-select" value={severityFilter} onChange={(e) => setSeverityFilter(e.target.value)}>
                                    <option value="all">All Severities</option>
                                    <option value="high">High Only</option>
                                    <option value="medium">Medium Only</option>
                                    <option value="low">Low Only</option>
                                </select>
                            </div>
                            {filteredConflicts.length === 0 ? (
                                <div className="empty-state"><div className="empty-icon"><Icons.Check /></div><h3>No Conflicts Found</h3><p>Great news! No policy conflicts were detected.</p></div>
                            ) : (
                                <div className="conflicts-list">
                                    {filteredConflicts.map(conflict => <ConflictCard key={conflict.id} conflict={conflict} expanded={expandedId === conflict.id} onToggle={() => setExpandedId(expandedId === conflict.id ? null : conflict.id)} />)}
                                </div>
                            )}
                        </>
                    )}

                    {activeTab !== 'conflicts' && (
                        <div className="policy-table">
                            <div className="policy-table-header"><div>Policy Name</div><div>Type</div><div>Platform</div><div>Status</div><div>Conflicts</div></div>
                            {(policies[activeTab] || []).map((policy, idx) => {
                                const conflictCount = conflicts.filter(c => c.instances.some(i => i.policy.id === policy.id)).length;
                                return (
                                    <div className="policy-table-row" key={policy.id || idx}>
                                        <div className="policy-name"><span className={`policy-type-icon ${POLICY_TYPES[activeTab]?.icon || ''}`}>{(POLICY_TYPES[activeTab]?.name || 'P')[0]}</span>{policy.displayName || policy.name || 'Unnamed'}</div>
                                        <div>{POLICY_TYPES[activeTab]?.name}</div>
                                        <div>{policy.platforms || 'All'}</div>
                                        <div><span className={`policy-status ${conflictCount > 0 ? 'has-conflicts' : 'clean'}`}>{conflictCount > 0 ? <><Icons.AlertTriangle /> Conflicts</> : <><Icons.Check /> Clean</>}</span></div>
                                        <div>{conflictCount || '-'}</div>
                                    </div>
                                );
                            })}
                            {(policies[activeTab] || []).length === 0 && <div className="empty-state"><div className="empty-icon"></div><h3>No Policies</h3><p>No {POLICY_TYPES[activeTab]?.name} policies found.</p></div>}
                        </div>
                    )}
                </div>
            );
        };

        const Toast = ({ message, type, onClose }) => {
            useEffect(() => { const t = setTimeout(onClose, 5000); return () => clearTimeout(t); }, [onClose]);
            return <div className={`toast ${type}`}><div className="toast-icon">{type === 'success' ? '' : '!'}</div><span>{message}</span></div>;
        };

        // Main App
        const App = () => {
            const auth = useAuth();
            const { fetchGraph, fetchAllPages } = useGraphApi(auth.getValidToken);
            const [policies, setPolicies] = useState({});
            const [conflicts, setConflicts] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [loadingProgress, setLoadingProgress] = useState(0);
            const [loadingStatus, setLoadingStatus] = useState('');
            const [toasts, setToasts] = useState([]);

            const addToast = (message, type = 'success') => setToasts(prev => [...prev, { id: Date.now(), message, type }]);
            const removeToast = (id) => setToasts(prev => prev.filter(t => t.id !== id));

            const fetchPolicies = useCallback(async () => {
                setIsLoading(true);
                setLoadingProgress(0);
                const allPolicies = {}, allAssignments = {}, allSettings = {};

                try {
                    const policyTypes = Object.entries(POLICY_TYPES);
                    let currentStep = 0;
                    const totalSteps = policyTypes.length * 3;

                    for (const [key, config] of policyTypes) {
                        setLoadingStatus(`Fetching ${config.name}...`);
                        try {
                            let fetched = await fetchAllPages(config.endpoint);
                            if (config.filter) fetched = fetched.filter(config.filter);
                            allPolicies[key] = fetched;
                            currentStep++; setLoadingProgress((currentStep / totalSteps) * 100);

                            if (config.assignmentsEndpoint) {
                                setLoadingStatus(`Fetching ${config.name} assignments...`);
                                for (const policy of fetched) {
                                    try { allAssignments[policy.id] = (await fetchGraph(config.assignmentsEndpoint(policy.id))).value || []; }
                                    catch { allAssignments[policy.id] = []; }
                                }
                            }
                            currentStep++; setLoadingProgress((currentStep / totalSteps) * 100);

                            const settingsEp = config.settingsEndpoint || config.valuesEndpoint;
                            if (settingsEp) {
                                setLoadingStatus(`Fetching ${config.name} settings...`);
                                for (const policy of fetched) {
                                    try { allSettings[policy.id] = (await fetchGraph(settingsEp(policy.id))).value || []; }
                                    catch { allSettings[policy.id] = []; }
                                }
                            }
                            currentStep++; setLoadingProgress((currentStep / totalSteps) * 100);
                        } catch (e) {
                            console.warn(`Error fetching ${config.name}:`, e);
                            allPolicies[key] = [];
                            currentStep += 3; setLoadingProgress((currentStep / totalSteps) * 100);
                        }
                    }

                    setLoadingStatus('Analyzing conflicts...');
                    const detected = analyzeConflicts(allPolicies, allAssignments, allSettings);
                    setPolicies(allPolicies);
                    setConflicts(detected);
                    const total = Object.values(allPolicies).reduce((s, a) => s + a.length, 0);
                    addToast(`Analyzed ${total} policies, found ${detected.length} conflicts`, detected.length > 0 ? 'error' : 'success');
                } catch (error) {
                    console.error('Fetch error:', error);
                    addToast(`Error: ${error.message}`, 'error');
                } finally {
                    setIsLoading(false);
                }
            }, [fetchGraph, fetchAllPages]);

            useEffect(() => {
                if (auth.isAuthenticated && Object.keys(policies).length === 0 && !isLoading) fetchPolicies();
            }, [auth.isAuthenticated]);

            if (auth.isLoading) return <div className="app-container"><Header user={null} onLogout={() => {}} /><main className="main-content"><div className="loading-container"><div className="loading-spinner"></div><h3>Loading...</h3></div></main></div>;

            return (
                <div className="app-container">
                    <Header user={auth.user} onLogout={auth.logout} />
                    <main className="main-content">
                        {!auth.isAuthenticated ? <AuthScreen onLogin={auth.login} error={auth.authError} /> : isLoading ? <LoadingScreen progress={loadingProgress} status={loadingStatus} /> : <Dashboard policies={policies} conflicts={conflicts} onRefresh={fetchPolicies} isRefreshing={isLoading} />}
                    </main>
                    <div className="toast-container">{toasts.map(toast => <Toast key={toast.id} message={toast.message} type={toast.type} onClose={() => removeToast(toast.id)} />)}</div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
